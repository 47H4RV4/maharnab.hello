<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Maharnab | Portfolio</title>
  <style>
    body{font-family:Inter,system-ui,Segoe UI,Roboto;background:linear-gradient(180deg,#071024 0%, #07122b 60%);color:#e6eef8;margin:0;padding:36px}
    .container{max-width:900px;margin:0 auto}
    header{display:flex;gap:18px;align-items:center}
    .avatar{width:84px;height:84px;border-radius:14px;background:linear-gradient(135deg,#7c3aed,#06b6d4);display:flex;align-items:center;justify-content:center;color:white;font-weight:700;font-size:28px}
    h1{margin:0;font-size:22px}
    .card{background:#0b1220;padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(2,6,23,0.6);margin-bottom:16px}
    ul.skills{display:flex;flex-wrap:wrap;gap:8px;padding:0;list-style:none;margin:6px 0}
    ul.skills li{background:rgba(255,255,255,0.04);padding:8px 10px;border-radius:999px;color:#94a3b8;font-size:13px}
    code{background:#071226;padding:2px 6px;border-radius:6px;color:#cde3ff}
    .input{display:flex;gap:8px}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{background:#7c3aed;border:none;color:white;padding:10px 12px;border-radius:8px;cursor:pointer}
    .kb,.sources{font-size:13px;color:#94a3b8;max-height:260px;overflow:auto;padding:8px;background:rgba(255,255,255,0.02);border-radius:8px}
    .snippet{background:rgba(255,255,255,0.02);padding:8px;margin-bottom:8px;border-radius:8px}
    .progress{background:#222;height:4px;border-radius:3px;overflow:hidden;margin-top:6px}
    .progress-bar{height:4px;background:#2d6af4}
    .badge{display:inline-block;padding:4px 8px;font-size:11px;border-radius:6px;background:linear-gradient(90deg,#0b1220,#19193f);color:#94a3b8;margin-left:8px}
    .suggestions{margin:6px 0}
    .suggestion{display:inline-block;padding:5px 10px;background:rgba(124,58,237,0.08);border-radius:7px;font-size:13px;color:#cde3ff;cursor:pointer;margin-right:8px}
  </style>
  <!-- Load TensorFlow.js Universal Sentence Encoder -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.14.0"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/universal-sentence-encoder@3.1.0"></script>
</head>
<body>
  <div class="container">
    <header>
      <div class="avatar">IIT</div>
      <div>
        <h1>I am Maharnab Samadder — Virtual Assistant</h1>
        <p style="color:#94a3b8;">Tech-forward VA focusing on admin, marketing, and developer-friendly automation. Try the advanced RAG demo below!</p>
      </div>
    </header>

    <section class="card">
      <h2>What I offer</h2>
      <ul>
        <li>Inbox & calendar management, scheduling, research, documentation</li>
        <li>Technical support: Notion, Airtable, Google Workspace, simple automations</li>
        <li>Marketing: social content, market research, email support</li>
        <li>Dev-friendly: I know <code>C++</code>, <code>Python</code>, <code>JavaScript</code> — can assist with small scripts, data cleanup and tooling</li>
      </ul>
      <h2>Top skills</h2>
      <ul class="skills">
        <li>Admin</li><li>Notion</li><li>Google Workspace</li><li>Python</li><li>JavaScript</li><li>Marketing</li><li>Automation</li>
      </ul>
    </section>

    <section class="card">
      <h2>RAG Demo — Advanced Search (BM25 + Semantic)</h2>
      <div>
        <div class="suggestions" id="suggestions"></div>
        <div class="input">
          <input id="query" type="text" placeholder="Ask about my skills or experience" aria-label="Query input"/>
          <button id="askBtn">Run</button>
        </div>
        <label style="display:block;margin:6px 0;">
          <input type="checkbox" id="semanticMode" checked /> Use Semantic Re-ranking (TensorFlow.js)
        </label>
        <div style="margin-top:10px">
          <h3>Generated answer</h3>
          <div id="answer" class="kb" style="min-height:120px"></div>
          <div id="srcs" class="sources"></div>
        </div>
      </div>
      <h3>Knowledge Base</h3>
      <div class="kb" id="kbList" aria-label="Knowledge Base"></div>
      <h3>Implementation notes</h3>
      <pre style="margin-bottom:0;">
BM25 keyword ranking + TensorFlow.js Universal Sentence Encoder for semantic re-ranking.
ES6+ modular architecture, query suggestions, relevance bar, accessibility.
      </pre>
    </section>
  </div>

  <script>
    // --- Knowledge base ---
    const KB = [
      {id: 'doc1', title: 'Scheduling Automation', text: 'I can automate scheduling by using Google Calendar APIs, setting up webhook-based calendar invites, and linking with a Notion or Airtable base. Typical flow: form -> availability check -> calendar invite. I have experience scripting in Python and JavaScript to connect APIs.'},
      {id: 'doc2', title: 'Social Media Support', text: 'I create social media content plan, design posts in Canva, schedule through Buffer, and track engagement metrics in a Google Sheet. I can also write captions and short post copy.'},
      {id: 'doc3', title: 'Market Research', text: 'Market research includes competitor analysis, pricing comparisons, and customer persona creation. I compile data in spreadsheets and summarize key insights in a one-page brief.'},
      {id: 'doc4', title: 'Notion & Workflow Templates', text: 'I build Notion dashboards with a weekly planner, project tracker, and meeting notes template. Integrates with Google Calendar and Slack for notifications.'},
      {id: 'doc5', title: 'Technical Support & Scripting', text: 'I can write small scripts in Python or JS to clean CSVs, automate report generation, or pull data from APIs. Comfortable with basic debugging and version control using git.'}
    ];
    // Suggested queries for UX
    const suggestions = [
      "How can you automate scheduling?",
      "Show sample market research outputs",
      "What are your top skills?",
      "Explain your Notion dashboards"
    ];
    document.getElementById('suggestions').innerHTML =
      suggestions.map(q=>`<span class="suggestion" tabindex="0">${q}</span>`).join('');
    document.querySelectorAll('.suggestion').forEach(el=>{
      el.addEventListener('click',()=>{ queryInput.value = el.textContent; });
      el.addEventListener('keydown',e=>{ if(e.key==="Enter") { queryInput.value = el.textContent; }});
    });

    // --- Advanced Tokenizer ---
    const STOPWORDS = new Set(["the","is","and","to","a","of","in","for","on","or","with","by","as","an","at","can","i"]);
    function tokenize(s){
      return s.toLowerCase().replace(/[^a-z0-9\s]/g,' ').split(/\s+/)
        .filter(t=>t && !STOPWORDS.has(t));
    }

    // --- BM25 Implementation ---
    function buildBM25(KB) {
      const N = KB.length;
      const avgdl = KB.reduce((sum,doc)=>sum+tokenize(doc.text).length,0)/N;
      const k1 = 1.2, b = 0.75;
      const docTokens = KB.map(doc=>tokenize(doc.text));
      const docLens = docTokens.map(toks=>toks.length);
      const termFreq = KB.map((doc, i) => {
        const freq = {};
        docTokens[i].forEach(t => freq[t] = (freq[t]||0)+1);
        return freq;
      });
      // IDF for all terms
      const df = {};
      docTokens.forEach(tokens=> {
        new Set(tokens).forEach(t=>{df[t]=(df[t]||0)+1});
      });
      const idf = {};
      Object.keys(df).forEach(t=>{
        idf[t] = Math.log(1 + (N - df[t] + 0.5)/(df[t] + 0.5));
      });
      // Score a query
      return function bm25Score(query){
        const qToks = tokenize(query);
        return KB.map((doc, i) => {
          let score = 0;
          qToks.forEach(t=>{
            if (!termFreq[i][t]) return;
            const tf = termFreq[i][t];
            score += idf[t] * ((tf*(k1+1))/(tf + k1*(1-b+b*(docLens[i]/avgdl))));
          });
          return score;
        });
      };
    }

    const bm25 = buildBM25(KB);

    // --- Universal Sentence Encoder (TensorFlow.js) ---
    let useModel = null;
    async function loadUSE() {
      useModel = await window.universalSentenceEncoder.load();
    }
    loadUSE(); // preload

    async function semanticEmbed(text) {
      if (!useModel) await loadUSE();
      const embedding = await useModel.embed([text]);
      return embedding.arraySync()[0]; // Returns array of 512 dims
    }
    // Cosine similarity
    function cosine(a,b){let s=0;for(let i=0;i<a.length;i++)s+=a[i]*b[i];
      const na=Math.sqrt(a.reduce((sum,v)=>sum+v*v,0)), nb=Math.sqrt(b.reduce((sum,v)=>sum+v*v,0));
      return s/(na*nb);
    }

    // --- Modular RAG Retriever ---
    async function hybridSearch(query, KB, semanticMode=true) {
      const bm25Scores = bm25(query);
      let results = KB.map((doc, i)=>({doc, bm25:bm25Scores[i], idx:i}));
      results.sort((a,b)=>b.bm25-a.bm25);
      results = results.slice(0,3);

      // Semantic reranking if enabled
      if (semanticMode && useModel) {
        const queryVec = await semanticEmbed(query);
        const docVecs = [];
        for(let res of results){ docVecs.push(await semanticEmbed(res.doc.text)); }
        results.forEach((r,i)=>{ r.semantic = cosine(queryVec, docVecs[i]); });
        results.sort((a,b)=>((a.bm25 + a.semantic)/2) < ((b.bm25 + b.semantic)/2) ? 1 : -1);
      }
      return results;
    }

    // --- UI Rendering ---
    const kbList = document.getElementById('kbList');
    KB.forEach(d=>{
      const el = document.createElement('div'); el.className='snippet';
      el.innerHTML = `<strong>${d.title}</strong><div style="margin-top:6px;color:#94a3b8;font-size:13px">${d.text}</div>`;
      kbList.appendChild(el);
    });

    // --- Event Handling ---
    const queryInput = document.getElementById('query');
    const askBtn = document.getElementById('askBtn');
    const answerBox = document.getElementById('answer');
    const srcs = document.getElementById('srcs');
    const semanticModeEl = document.getElementById('semanticMode');

    async function runQuery() {
      const q = queryInput.value.trim();
      const semanticMode = semanticModeEl.checked;
      if(!q) { answerBox.textContent = 'Please enter a query.'; srcs.textContent=''; return; }
      answerBox.textContent = 'Thinking...';
      srcs.textContent = '';
      setTimeout(async ()=>{
        const results = await hybridSearch(q, KB, semanticMode);
        // Compose answer and show context
        answerBox.innerHTML = results.map(res=>`
          <div style="margin-bottom:10px">
            <strong>${res.doc.title}</strong>
            <span class="badge">Score: ${(res.bm25).toFixed(2)}${semanticMode && res.semantic ? `, Semantic: ${res.semantic.toFixed(2)}` : ''}</span>
            <div class="progress"><div class="progress-bar" style="width:${(Math.min(1,(res.bm25+(res.semantic||0))/2)*100).toFixed(0)}%"></div></div>
            <div style="margin-top:5px;color:#94a3b8;font-size:14px">${extractRelevantSentences(res.doc, q)}</div>
          </div>
        `).join('');
        srcs.textContent = 'Sources: ' + results.map(res=>res.doc.title).join(' · ');
      }, 100);
    }
    askBtn.onclick = runQuery;
    queryInput.addEventListener('keydown',e=>{ if(e.key==='Enter') runQuery(); });

    // --- Helper: Extract most relevant sentences ---
    function extractRelevantSentences(doc, query){
      const terms = tokenize(query);
      const sents = doc.text.match(/[^\.\!\?]+[\.\!\?]?/g) || [doc.text];
      const chosen = sents.filter(s=> terms.some(t=> s.toLowerCase().includes(t))).slice(0,3);
      return chosen.length? chosen.join(' ') : sents.slice(0,1).join(' ');
    }
  </script>
</body>
</html>
